apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
metadata:
  name: e705-back
  namespace: doa-e705-dev
resources:
  - deployment.yaml
  - service.yaml
  - service-monitoring.yaml
  - service-account.yaml
  - ingress-core.yaml
  - ingress-public.yaml
  - external-secret.yaml
# Common labels applied to all resources
labels:
  - pairs:
      app.kubernetes.io/name: e705-back
      app.kubernetes.io/component: e705-back
      app.kubernetes.io/part-of: e705-app
configMapGenerator:
  - name: e705-back-config
    files:
      - config/application.yaml
    literals:
      - SPRING_PROFILES_ACTIVE=dev
    options:
      disableNameSuffixHash: true
secretGenerator:
  - name: ca-certs-secret
    files:
      - certs/finbel-root-ca.pem
# Image transformations
images:
  - name: e705
    newName: finvmharborp01.finbel.intra/doa-e705/e705
    newTag: 3.0.0-962-9b169185
# Resource customization
replicas:
  - name: e705-back-deployment
    count: 1
# Add resource constraints to all containers
patches:
  - target:
      kind: Deployment
      name: e705-back-deployment
    patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: e705-back-deployment
      spec:
        template:
          spec:
            containers:
              - name: e705-back
                resources:
                  limits:
                    memory: 2Gi
                    cpu: 1000m
                  requests:
                    cpu: 100m
                    memory: 256Mi
                    ephemeral-storage: 1Gi
